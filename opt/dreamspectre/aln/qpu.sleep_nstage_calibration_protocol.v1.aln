section,field,datatype,unit,required,description
META,shard_id,string,,true,"Unique ID: sleep_nstage_calibration_protocol.v1"
META,version,string,,true,"Semantic version of this calibration spec"
META,created_utc,timestamp,,true,"Creation time in UTC"
META,jurisdiction_primary,string,,true,"Primary governance locus (e.g., CH-GE, EU-BE, CL-RM, US-CA, US-AZ)"
META,authoring_stack,string,,true,"dream_ai_n1n2_automation + DreamSpectre + Retoplasm + Reality.os"
META,linked_shard_sleep_syntax,string,,true,"ID of qpu.dreamspectre_sleep_syntax_n_stages.aln"

COHORT,cohort_id,string,,true,"Opaque cohort identifier (non-PII)"
COHORT,site_tag,string,,true,"PHOENIX_LAB / LAJOLLA_PSG / GENEVA_ETHICS / BRUSSELS_AI / SANTIAGO_NEURORIGHTS"
COHORT,n_subjects,int,,true,"Number of participants in this cohort"
COHORT,n_nights_per_subject,int,,true,"PSG nights per subject"
COHORT,psg_modality,string,,true,"EEG+EOG+EMG+ECG, device types, montage summary"
COHORT,wearable_modality,string,,false,"If used: headband, PPG, IMU, etc."
COHORT,irb_or_ethics_ref,string,,true,"IRB or ethics board reference ID"
COHORT,notes,string,,false,"Free-text notes for protocol versioning"

FEATURES,use_swa_05_4hz,bool,,true,"If true, include SWA 0.5–4 Hz in depth index"
FEATURES,use_swa_05_1hz,bool,,true,"If true, include SWA 0.5–1 Hz band"
FEATURES,use_spindle_kcomplex,bool,,true,"If true, include spindle/K-complex density features"
FEATURES,use_hrv,bool,,true,"If true, include HRV/PRV features (RRI, HF, LF/HF)"
FEATURES,use_eog_emg,bool,,true,"If true, include EOG/EMG envelopes"
FEATURES,epoch_length_seconds,int,s,true,"Epoch length (default 30 s)"
FEATURES,window_overlap_seconds,int,s,true,"Analysis window overlap (if any)"

DEPTH_INDEX,formula_id,string,,true,"Identifier for D_N2N3 formula version"
DEPTH_INDEX,coef_pn2,float,,true,"Weight for pN2 in D_N2N3 (e.g., 0.4–0.5)"
DEPTH_INDEX,coef_pn3,float,,true,"Weight for pN3 in D_N2N3 (e.g., 1.0–1.2)"
DEPTH_INDEX,coef_swa,float,,true,"Weight for normalized SWA in D_N2N3 (e.g., 0.3–0.5)"
DEPTH_INDEX,depth_clamp_min,float,,true,"Minimum clamp value for D_N2N3 (usually 0.0)"
DEPTH_INDEX,depth_clamp_max,float,,true,"Maximum clamp value for D_N2N3 (usually 1.0)"
DEPTH_INDEX,depth_target_corr_min,float,,true,"Minimum target Pearson r vs SWA/ORP for acceptance (e.g., 0.6)"

UNCERTAINTY,ucalc_formula_id,string,,true,"Identifier for U_gap/U_ent/U_comb definition"
UNCERTAINTY,use_temperature_scaling,bool,,true,"If true, apply post-hoc calibration to posteriors"
UNCERTAINTY,ece_target_max,float,,true,"Max allowed Expected Calibration Error (e.g., 0.05)"
UNCERTAINTY,high_ambiguity_threshold,float,,true,"Threshold on U_comb for '?' region (e.g., 0.5)"
UNCERTAINTY,uncertainty_bin_count,int,,true,"Number of bins for reliability diagrams (e.g., 10)"
UNCERTAINTY,requires_hypnodensity,bool,,true,"If true, hypnodensity outputs must be stored for analysis"

GSAFE,gsafe_formula_id,string,,true,"Identifier for G_safe = min(1, D_N2N3 * (1 - U_comb)) version"
GSAFE,band_control_max,float,,true,"Upper bound of CONTROL band (e.g., 0.4)"
GSAFE,band_monitored_max,float,,true,"Upper bound of MONITORED band (e.g., 0.7)"
GSAFE,band_restricted_max,float,,true,"Upper bound of RESTRICTED band (e.g., 0.9)"
GSAFE,false_safe_target_max,float,,true,"Max allowed false-safe rate (e.g., 0.10)"
GSAFE,false_unsafe_target_max,float,,true,"Max allowed false-unsafe rate (e.g., 0.20)"
GSAFE,calibration_sessions_min,int,,true,"Min number of nights per cohort to compute stable bands"

MICROAROUSAL,ma_detection_method,string,,true,"Algorithm/reference for micro-arousal detection"
MICROAROUSAL,ma_veto_enabled,bool,,true,"If true, microarousal_veto must block XR routing"
MICROAROUSAL,ma_cooldown_seconds,int,s,true,"Cooldown duration after veto-triggering epoch"
MICROAROUSAL,ma_corr_awakenings_min,float,,true,"Min correlation with awakenings/mood metrics to accept detection method"

EVAL_METRICS,metric_epoch_accuracy,float,,true,"Target overall epoch-wise staging accuracy vs human PSG"
EVAL_METRICS,metric_n2n3_kappa,float,,true,"Target Cohen's kappa for N2/N3 vs human PSG"
EVAL_METRICS,metric_depth_corr,float,,true,"Observed r(D_N2N3, SWA or ORP) in this calibration run"
EVAL_METRICS,metric_false_safe_rate,float,,true,"Observed false-safe rate for chosen G_safe bands"
EVAL_METRICS,metric_false_unsafe_rate,float,,true,"Observed false-unsafe rate for chosen G_safe bands"
EVAL_METRICS,metric_ece,float,,true,"Observed Expected Calibration Error for posteriors"
EVAL_METRICS,metric_ma_veto_precision,float,,true,"Precision of microarousal_veto on high-risk epochs"
EVAL_METRICS,metric_ma_veto_recall,float,,true,"Recall of microarousal_veto on high-risk epochs"

ACCEPTANCE,accept_depth_index,bool,,true,"True if depth_index targets met (corr and clamps)"
ACCEPTANCE,accept_uncertainty,bool,,true,"True if ECE and ambiguity thresholds met"
ACCEPTANCE,accept_gsafe,bool,,true,"True if false-safe/false-unsafe targets met"
ACCEPTANCE,accept_microarousal,bool,,true,"True if micro-arousal detection meets criteria"
ACCEPTANCE,accept_overall,bool,,true,"True if all prior acceptance flags are true"

LEGAL,license_descriptor,string,,true,"SPDX or custom license for calibration data use"
LEGAL,neuroethics_board_ref,string,,true,"Ethics/neurorights board overseeing this protocol"
LEGAL,terms_neurorights_minimum,string,,true,"Textual clause: non-punitive, no_person_scoring, mental privacy"

FOOTER,END-OF-SHARD,string,,true,"End of calibration protocol definition"
