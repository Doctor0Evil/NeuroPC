name: Sovereign Kernel CI

on:
  pull_request:
    paths:
      - "bostrom-sovereign-kernel-*.ndjson"
      - ".neurofs-index.aln"
      - "**/*.aln"
      - "**/*.lifaln"
      - "**/*.neuro-cap.aln"
      - "**/*.neurorights.json"
      - "**/*.evolve.jsonl"
      - "logs/evolution/*.aln"
      - "crates/**"

jobs:
  sovereign-checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Build workspace
        run: cargo build --workspace --locked

      - name: Run neuro-sovereign-spec and RoH/actuation tests
        run: cargo test -p sovereigntycore --features ciguard

      - name: Run neuro-sovereign lints
        run: cargo run -p neuro-sovereign-lint -- --fail-on-warn

      - name: Run sovereigntycore guards on proposed changes
        run: cargo test -p sovereigntycore --features ci_guard
